var BrickCols={init:function(){function t(t,e){var r,i=getComputedStyle(t);switch(e){case"width":r=t.offsetWidth,r+=parseInt(i.marginLeft)+parseInt(i.marginRight);break;case"height":r=t.offsetHeight,r+=Math.max(parseInt(i.marginTop),parseInt(i.marginBottom))}return r}function e(t,e,r){switch(e){case"html":t.innerHTML=r;break;case"href":t.setAttribute("href",r);break;case"src":t.setAttribute("src",r);break;case"class":t.classList?t.classList.add(r):t.className+=" "+r;break;case"remove_class":t.classList?t.classList.remove(r):t.className=t.className.replace(new RegExp("(^|\\b)"+r.split(" ").join("|")+"(\\b|$)","gi")," ")}}this._name="BrickCols",this._description="Cascading grid layout without absolute positioning. You don't need to use any JS code to set stylesheet properties.",this._version="2.1.0",this._autor="Magomedov Said",this.add_new=function(t,r,i,o,a){if(!Array.isArray(i))return!1;if(t=document.querySelector(t),a=a?document.querySelector('[data-brickcols-template="'+a+'"]'):t.querySelector(".brickcols_template"),!a)return!1;a=a.cloneNode(!0),i.forEach(function(t){if(!(t[0]&&t[1]&&t[2]))return!1;if("this"==t[0])return e(a,t[1],t[2]),!1;var r=a.querySelectorAll('[data-bc-t="'+t[0]+'"');Array.prototype.slice.call(r).forEach(function(r){e(r,t[1],t[2])})}),o=o||"",a.setAttribute("data-priority",o),a.classList.remove("brickcols_template");var c=0,s=t.querySelector(r).offsetHeight;Array.prototype.slice.call(t.querySelectorAll(r+":not(:empty)")).forEach(function(t,e){t.offsetHeight<s&&(s=t.offsetHeight,c=e)});var l=t.querySelector(r+":nth-child("+ ++c+")");return l.appendChild(a),!0},this.auto_prioritize=function(t,e){[t].forEach(function(t){var r=1;Array.prototype.slice.call(t.querySelectorAll(e)).forEach(function(i){var o=i.getAttribute("data-priority"),a=parseInt(o);if(a&&a==o)return!1;for(;t.querySelectorAll(e+'[data-priority="'+r+'"]').length;)r++;i.setAttribute("data-priority",r)})})},this.layout_optimization=function(e,r,i,o){var a=this;Array.prototype.slice.call(document.querySelectorAll(e)).forEach(function(e){for(var c=e.querySelectorAll(r),s=e.querySelectorAll(i),l=parseInt(e.offsetWidth/t(c[0],"width")),n=[],u=0;l>u;u++)n[u]=0;for(var u=c.length;l>u;u++){var f=c[0].cloneNode(!0);f.innerHTML="",e.appendChild(f)}a.auto_prioritize(e,i);for(var h=s.length,p=1,d=200;h>0;)s=Array.prototype.slice.call(e.querySelectorAll(i+'[data-priority="'+p+'"]')),s.length?s.forEach(function(t){for(var i=n[0],o=0,a=1;l>a;a++)n[a]<i&&(i=n[a],o=a);n[o]+=t.offsetHeight;var c=e.querySelector(r+":nth-child("+ ++o+")");c.appendChild(t),d=200,--h}):--d||(h=0,o&&o("Разница между индексами приоритетов больше 200")),p++}),o&&o()}}},BrickCols=new BrickCols.init;
